<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Debug API Admin - CORRIGIDO</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #1a1a1a;
            color: #00ff00;
            min-height: 100vh;
            padding: 20px;
            font-size: 14px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .panel {
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 5px;
            padding: 15px;
            overflow: hidden;
        }
        
        .panel-title {
            color: #00ffff;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #444;
            font-weight: bold;
            font-size: 16px;
        }
        
        .panel-title::before {
            content: "‚ñ∏ ";
            color: #ff9900;
        }
        
        .url-display {
            background: #000;
            padding: 10px;
            border-radius: 3px;
            margin-bottom: 15px;
            border-left: 3px solid #00ff00;
            font-size: 13px;
            word-break: break-all;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            color: #cccccc;
            margin-bottom: 5px;
            font-size: 13px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 8px 10px;
            background: #1a1a1a;
            border: 1px solid #555;
            border-radius: 3px;
            color: #fff;
            font-family: 'Consolas', monospace;
            font-size: 13px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #00aaff;
            box-shadow: 0 0 5px rgba(0, 170, 255, 0.3);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            padding: 8px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-family: 'Consolas', monospace;
            font-weight: bold;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #0066cc;
            color: white;
        }
        
        .btn-success {
            background: #00aa44;
            color: white;
        }
        
        .btn-danger {
            background: #cc3300;
            color: white;
        }
        
        .btn-warning {
            background: #ff9900;
            color: #000;
        }
        
        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .response-area {
            background: #000;
            border: 1px solid #444;
            border-radius: 3px;
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .log-area {
            background: #000;
            border: 1px solid #444;
            border-radius: 3px;
            padding: 10px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 11px;
            line-height: 1.3;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
            border-bottom: 1px dashed #333;
        }
        
        .log-time {
            color: #888;
            font-size: 10px;
            margin-right: 10px;
        }
        
        .log-type-info {
            color: #00aaff;
        }
        
        .log-type-success {
            color: #00ff00;
        }
        
        .log-type-error {
            color: #ff4444;
        }
        
        .log-type-warning {
            color: #ff9900;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-online {
            background: #00ff00;
            box-shadow: 0 0 5px #00ff00;
        }
        
        .status-offline {
            background: #ff0000;
            box-shadow: 0 0 5px #ff0000;
        }
        
        .json-key {
            color: #00aaff;
        }
        
        .json-string {
            color: #00ff99;
        }
        
        .json-number {
            color: #ff9900;
        }
        
        .json-boolean {
            color: #ff4444;
        }
        
        .json-null {
            color: #888;
        }
        
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #444;
            margin-bottom: 15px;
        }
        
        .tab {
            padding: 8px 15px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            color: #aaa;
        }
        
        .tab.active {
            background: #1a1a1a;
            border-color: #444;
            color: #fff;
            border-bottom: 1px solid #1a1a1a;
            margin-bottom: -1px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .http-method {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 5px;
        }
        
        .method-get { background: #00aa44; color: white; }
        .method-post { background: #0066cc; color: white; }
        
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Painel de Controle -->
        <div class="panel">
            <div class="panel-title">üîß CONTROLE DA API</div>
            
            <div class="url-display" id="apiUrl">
                API: https://script.google.com/macros/s/AKfycby1RlOGjnMX18Cu-SDEoRMvdKlhNFdLDZRBVHXGkQKu4CCtKSRfFP2T4AyyjWejIDTUZA/exec
            </div>
            
            <div class="form-group">
                <label for="apiStatus">Status da Conex√£o:</label>
                <div id="apiStatus" style="padding: 8px; background: #1a1a1a; border-radius: 3px;">
                    <span class="status-indicator status-offline" id="statusDot"></span>
                    <span id="statusText">Testando conex√£o...</span>
                </div>
            </div>
            
            <div class="tabs">
                <div class="tab active" onclick="switchTab('tab-test')">üß™ Testes</div>
                <div class="tab" onclick="switchTab('tab-manual')">üîß Manual</div>
                <div class="tab" onclick="switchTab('tab-batch')">‚ö° Batch</div>
            </div>
            
            <!-- Tab: Testes -->
            <div class="tab-content active" id="tab-test">
                <div class="form-group">
                    <label for="testAction">A√ß√£o de Teste:</label>
                    <select id="testAction" onchange="updateTestForm()">
                        <option value="list">üìã Listar Abas</option>
                        <option value="stats">üìä Estat√≠sticas</option>
                        <option value="read">üìñ Ler Dados</option>
                        <option value="add">‚ûï Adicionar</option>
                        <option value="edit">‚úèÔ∏è Editar</option>
                        <option value="updatecell">üìç Atualizar C√©lula</option>
                        <option value="delete">üóëÔ∏è Excluir</option>
                        <option value="clear">üßπ Limpar</option>
                    </select>
                </div>
                
                <!-- Formul√°rio din√¢mico baseado na a√ß√£o -->
                <div id="testFormContainer">
                    <!-- Formul√°rio ser√° gerado dinamicamente -->
                </div>
                
                <div class="btn-group">
                    <button class="btn-primary" onclick="executeTest()">‚ñ∂Ô∏è Executar Teste</button>
                    <button class="btn-warning" onclick="clearResponse()">üßπ Limpar Resposta</button>
                </div>
            </div>
            
            <!-- Tab: Manual -->
            <div class="tab-content" id="tab-manual">
                <div class="form-group">
                    <label for="manualMethod">M√©todo HTTP:</label>
                    <select id="manualMethod" onchange="updateManualMethod()">
                        <option value="GET" selected>GET</option>
                        <option value="POST">POST</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="manualParams">Par√¢metros (JSON):</label>
                    <textarea id="manualParams" rows="8">{
  "action": "list"
}</textarea>
                </div>
                
                <div class="btn-group">
                    <button class="btn-primary" onclick="executeManual()">‚ñ∂Ô∏è Executar Manual</button>
                    <button class="btn-warning" onclick="clearManual()">üßπ Limpar</button>
                    <button class="btn-success" onclick="testAddArquivo()">‚ûï Teste Add</button>
                </div>
            </div>
            
            <!-- Tab: Batch -->
            <div class="tab-content" id="tab-batch">
                <div class="form-group">
                    <label for="batchTests">Testes em Lote (JSON Array):</label>
                    <textarea id="batchTests" rows="10">[
  {
    "method": "GET",
    "params": { "action": "list" },
    "description": "Listar abas"
  },
  {
    "method": "GET", 
    "params": { "action": "stats" },
    "description": "Estat√≠sticas"
  },
  {
    "method": "GET",
    "params": { "action": "read", "sheet": "Arquivos" },
    "description": "Ler arquivos"
  }
]</textarea>
                </div>
                
                <div class="btn-group">
                    <button class="btn-success" onclick="runBatchTests()">‚ö° Executar Batch</button>
                    <button class="btn-warning" onclick="clearBatch()">üßπ Limpar</button>
                </div>
            </div>
        </div>
        
        <!-- Painel de Resposta -->
        <div class="panel">
            <div class="panel-title">üì° RESPOSTA DA API</div>
            
            <div class="form-group">
                <label for="responseTime">Tempo de Resposta:</label>
                <div id="responseTime" style="padding: 8px; background: #1a1a1a; border-radius: 3px;">
                    Aguardando execu√ß√£o...
                </div>
            </div>
            
            <div class="response-area" id="responseContainer">
                <pre id="responseOutput">Nenhuma resposta ainda. Execute um teste.</pre>
            </div>
            
            <div class="btn-group">
                <button class="btn-warning" onclick="clearAllLogs()">üóëÔ∏è Limpar Logs</button>
                <button class="btn-primary" onclick="copyResponse()">üìã Copiar Resposta</button>
                <button class="btn-danger" onclick="exportLogs()">üíæ Exportar Logs</button>
            </div>
        </div>
        
        <!-- Painel de Logs -->
        <div class="panel">
            <div class="panel-title">üìù LOGS DE DEBUG</div>
            
            <div class="form-group">
                <div style="display: flex; justify-content: space-between; color: #aaa; font-size: 12px;">
                    <span>Total logs: <span id="logCount">0</span></span>
                    <span>√öltima atualiza√ß√£o: <span id="lastUpdate">--:--:--</span></span>
                </div>
            </div>
            
            <div class="log-area" id="logContainer">
                <!-- Logs ser√£o inseridos aqui -->
            </div>
        </div>
        
        <!-- Painel de Dados -->
        <div class="panel">
            <div class="panel-title">üíæ DADOS DA PLANILHA</div>
            
            <div class="form-group">
                <label for="dataPreview">Pr√©-visualiza√ß√£o:</label>
                <select id="dataPreview" onchange="loadDataPreview()">
                    <option value="">Selecione uma aba...</option>
                    <option value="Aulas">Aulas</option>
                    <option value="Usuarios">Usuarios</option>
                    <option value="Arquivos">Arquivos</option>
                    <option value="Logs">Logs</option>
                </select>
            </div>
            
            <div class="response-area" id="dataPreviewContainer">
                Selecione uma aba para visualizar os dados...
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√£o
        const API_URL = "https://script.google.com/macros/s/AKfycby1RlOGjnMX18Cu-SDEoRMvdKlhNFdLDZRBVHXGkQKu4CCtKSRfFP2T4AyyjWejIDTUZA/exec";
        let logs = [];
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            testConnection();
            updateTestForm();
            updateLogDisplay();
        });
        
        // Testar conex√£o com a API
        async function testConnection() {
            addLog('üîç Testando conex√£o com a API...', 'info');
            
            try {
                const startTime = Date.now();
                const url = `${API_URL}?action=list`;
                const response = await fetch(url);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                if (response.ok) {
                    const data = await response.json();
                    
                    document.getElementById('statusDot').className = 'status-indicator status-online';
                    document.getElementById('statusText').innerHTML = 
                        `‚úÖ CONECTADO (${responseTime}ms) | API: ${data.success ? 'OK' : 'ERRO'}`;
                    
                    addLog(`‚úÖ Conex√£o estabelecida em ${responseTime}ms`, 'success');
                    addLog(`üìã API retornou: ${data.success ? 'sucesso' : 'erro'}`, 'info');
                    
                    if (data.data && data.data.sheets) {
                        addLog(`üìÅ Abas dispon√≠veis: ${data.data.sheets.map(s => s.name).join(', ')}`, 'info');
                    }
                    
                } else {
                    document.getElementById('statusDot').className = 'status-indicator status-offline';
                    document.getElementById('statusText').textContent = '‚ùå ERRO NA CONEX√ÉO';
                    addLog(`‚ùå Erro HTTP: ${response.status} ${response.statusText}`, 'error');
                }
                
            } catch (error) {
                document.getElementById('statusDot').className = 'status-indicator status-offline';
                document.getElementById('statusText').innerHTML = `‚ùå FALHA: ${error.message}`;
                addLog(`‚ùå Erro de conex√£o: ${error.message}`, 'error');
            }
        }
        
        // Adicionar log
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('pt-BR', { 
                hour12: false,
                fractionalSecondDigits: 3 
            });
            
            const logEntry = {
                timestamp: timestamp,
                type: type,
                message: message
            };
            
            logs.unshift(logEntry); // Adiciona no in√≠cio
            updateLogDisplay();
            
            // Limitar logs a 100 entradas
            if (logs.length > 100) {
                logs = logs.slice(0, 100);
            }
        }
        
        // Atualizar display de logs
        function updateLogDisplay() {
            const logContainer = document.getElementById('logContainer');
            const logCount = document.getElementById('logCount');
            const lastUpdate = document.getElementById('lastUpdate');
            
            logContainer.innerHTML = '';
            logCount.textContent = logs.length;
            lastUpdate.textContent = new Date().toLocaleTimeString('pt-BR');
            
            logs.forEach(log => {
                const logElement = document.createElement('div');
                logElement.className = 'log-entry';
                logElement.innerHTML = `
                    <span class="log-time">[${log.timestamp}]</span>
                    <span class="log-type-${log.type}">${getLogIcon(log.type)} ${log.message}</span>
                `;
                logContainer.appendChild(logElement);
            });
        }
        
        function getLogIcon(type) {
            const icons = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            };
            return icons[type] || 'üìù';
        }
        
        // Alternar entre tabs
        function switchTab(tabId) {
            // Remover active de todas as tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Adicionar active na tab selecionada
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        // Atualizar m√©todo manual
        function updateManualMethod() {
            const method = document.getElementById('manualMethod').value;
            const paramsText = document.getElementById('manualParams');
            
            if (method === 'GET') {
                paramsText.value = `{
  "action": "list"
}`;
            } else {
                paramsText.value = `{
  "action": "add",
  "sheet": "Arquivos",
  "id": "TESTE-${Date.now()}",
  "nome": "Arquivo Teste",
  "link": "https://teste.com",
  "tipo": "teste"
}`;
            }
        }
        
        // Atualizar formul√°rio de teste baseado na a√ß√£o
        function updateTestForm() {
            const action = document.getElementById('testAction').value;
            const container = document.getElementById('testFormContainer');
            
            let formHTML = '';
            
            switch(action) {
                case 'list':
                    formHTML = `
                        <div class="form-group">
                            <label>A√ß√£o: Listar todas as abas da planilha</label>
                            <div style="color: #aaa; font-size: 12px; margin-top: 5px;">
                                Esta a√ß√£o retorna informa√ß√µes sobre todas as abas dispon√≠veis.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'stats':
                    formHTML = `
                        <div class="form-group">
                            <label>A√ß√£o: Obter estat√≠sticas</label>
                            <div style="color: #aaa; font-size: 12px; margin-top: 5px;">
                                Retorna contagem de registros e informa√ß√µes gerais.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'read':
                    formHTML = `
                        <div class="form-group">
                            <label for="readSheet">Aba:</label>
                            <select id="readSheet">
                                <option value="Aulas">Aulas</option>
                                <option value="Usuarios">Usuarios</option>
                                <option value="Arquivos">Arquivos</option>
                                <option value="Logs">Logs</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="readSearch">Buscar (opcional):</label>
                            <input type="text" id="readSearch" placeholder="Termo para busca">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div class="form-group">
                                <label for="readPage">P√°gina:</label>
                                <input type="number" id="readPage" value="1" min="1">
                            </div>
                            <div class="form-group">
                                <label for="readLimit">Limite:</label>
                                <input type="number" id="readLimit" value="20" min="1" max="100">
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'add':
                    formHTML = `
                        <div class="form-group">
                            <label for="addSheet">Aba:</label>
                            <select id="addSheet" onchange="updateAddForm()">
                                <option value="Aulas">Aulas</option>
                                <option value="Usuarios">Usuarios</option>
                                <option value="Arquivos" selected>Arquivos</option>
                                <option value="Logs">Logs</option>
                            </select>
                        </div>
                        <div id="addFieldsContainer">
                            <!-- Campos ser√£o gerados dinamicamente -->
                        </div>
                    `;
                    setTimeout(updateAddForm, 10);
                    break;
                    
                case 'edit':
                    formHTML = `
                        <div class="form-group">
                            <label for="editSheet">Aba:</label>
                            <select id="editSheet">
                                <option value="Aulas">Aulas</option>
                                <option value="Usuarios">Usuarios</option>
                                <option value="Arquivos">Arquivos</option>
                                <option value="Logs">Logs</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editId">ID do Registro:</label>
                            <input type="text" id="editId" placeholder="Ex: 1, TESTE-API">
                        </div>
                        <div class="form-group">
                            <label for="editField">Campo para Editar:</label>
                            <input type="text" id="editField" placeholder="Ex: nome, link, tipo">
                        </div>
                        <div class="form-group">
                            <label for="editValue">Novo Valor:</label>
                            <input type="text" id="editValue" placeholder="Novo valor do campo">
                        </div>
                    `;
                    break;
                    
                case 'updatecell':
                    formHTML = `
                        <div class="form-group">
                            <label for="cellSheet">Aba:</label>
                            <select id="cellSheet">
                                <option value="Aulas">Aulas</option>
                                <option value="Usuarios">Usuarios</option>
                                <option value="Arquivos">Arquivos</option>
                                <option value="Logs">Logs</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="cellRow">Linha:</label>
                            <input type="number" id="cellRow" placeholder="N√∫mero da linha (come√ßa em 2)" min="2">
                        </div>
                        <div class="form-group">
                            <label for="cellColumnName">Nome da Coluna:</label>
                            <input type="text" id="cellColumnName" placeholder="Ex: nome, apelido, link">
                        </div>
                        <div class="form-group">
                            <label for="cellValue">Novo Valor:</label>
                            <input type="text" id="cellValue" placeholder="Valor para a c√©lula">
                        </div>
                    `;
                    break;
                    
                case 'delete':
                    formHTML = `
                        <div class="form-group">
                            <label for="deleteSheet">Aba:</label>
                            <select id="deleteSheet">
                                <option value="Aulas">Aulas</option>
                                <option value="Usuarios">Usuarios</option>
                                <option value="Arquivos">Arquivos</option>
                                <option value="Logs">Logs</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="deleteId">ID do Registro:</label>
                            <input type="text" id="deleteId" placeholder="Ex: 1, TESTE-API">
                        </div>
                        <div style="color: #ff9900; font-size: 12px; margin-top: 10px;">
                            ‚ö†Ô∏è Esta a√ß√£o n√£o pode ser desfeita!
                        </div>
                    `;
                    break;
                    
                case 'clear':
                    formHTML = `
                        <div class="form-group">
                            <label for="clearSheet">Aba:</label>
                            <select id="clearSheet">
                                <option value="Aulas">Aulas</option>
                                <option value="Usuarios">Usuarios</option>
                                <option value="Arquivos">Arquivos</option>
                                <option value="Logs">Logs</option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div class="form-group">
                                <label for="clearStartRow">Linha Inicial:</label>
                                <input type="number" id="clearStartRow" value="2" min="2">
                            </div>
                            <div class="form-group">
                                <label for="clearEndRow">Linha Final (opcional):</label>
                                <input type="number" id="clearEndRow" placeholder="Deixe em branco para limpar tudo">
                            </div>
                        </div>
                        <div style="color: #ff4444; font-size: 12px; margin-top: 10px;">
                            üö® PERIGO: Esta a√ß√£o apagar√° dados permanentemente!
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = formHTML;
        }
        
        // Atualizar formul√°rio de adi√ß√£o baseado na aba
        function updateAddForm() {
            const sheet = document.getElementById('addSheet').value;
            const container = document.getElementById('addFieldsContainer');
            
            let fieldsHTML = '';
            const timestamp = Date.now();
            
            switch(sheet) {
                case 'Aulas':
                    fieldsHTML = `
                        <div class="form-group">
                            <label for="addCategoria">categoria:</label>
                            <input type="text" id="addCategoria" placeholder="Ex: Programa√ß√£o" value="Teste">
                        </div>
                        <div class="form-group">
                            <label for="addNome">nome:</label>
                            <input type="text" id="addNome" placeholder="Nome da aula" value="Aula Teste ${timestamp}">
                        </div>
                        <div class="form-group">
                            <label for="addUrl">url:</label>
                            <input type="text" id="addUrl" placeholder="https://..." value="https://exemplo.com">
                        </div>
                        <div class="form-group">
                            <label for="addTipo">tipo:</label>
                            <input type="text" id="addTipo" placeholder="Ex: video, texto" value="video">
                        </div>
                    `;
                    break;
                    
                case 'Usuarios':
                    fieldsHTML = `
                        <div class="form-group">
                            <label for="addCodigo">codigo:</label>
                            <input type="text" id="addCodigo" placeholder="Ex: USR001" value="USR${timestamp}">
                        </div>
                        <div class="form-group">
                            <label for="addApelido">apelido:</label>
                            <input type="text" id="addApelido" placeholder="Nome do usu√°rio" value="Usu√°rio Teste">
                        </div>
                        <div class="form-group">
                            <label for="addAulasConcluidas">aulas conclu√≠das:</label>
                            <input type="number" id="addAulasConcluidas" value="0" min="0">
                        </div>
                        <div class="form-group">
                            <label for="addAulasDisponiveis">aulas dispon√≠veis:</label>
                            <input type="number" id="addAulasDisponiveis" value="0" min="0">
                        </div>
                        <div class="form-group">
                            <label for="addAcessoTreinamento">acesso treinamento:</label>
                            <select id="addAcessoTreinamento">
                                <option value="sim">sim</option>
                                <option value="n√£o">n√£o</option>
                            </select>
                        </div>
                    `;
                    break;
                    
                case 'Arquivos':
                    fieldsHTML = `
                        <div class="form-group">
                            <label for="addId">id:</label>
                            <input type="text" id="addId" placeholder="Ex: ARQ001" value="TESTE-${timestamp}">
                        </div>
                        <div class="form-group">
                            <label for="addNome">nome:</label>
                            <input type="text" id="addNome" placeholder="Nome do arquivo" value="Arquivo Teste ${timestamp}">
                        </div>
                        <div class="form-group">
                            <label for="addLink">link:</label>
                            <input type="text" id="addLink" placeholder="https://..." value="https://drive.google.com/teste">
                        </div>
                        <div class="form-group">
                            <label for="addTipo">tipo:</label>
                            <select id="addTipo">
                                <option value="link">link</option>
                                <option value="download">download</option>
                                <option value="video">video</option>
                            </select>
                        </div>
                    `;
                    break;
                    
                case 'Logs':
                    fieldsHTML = `
                        <div class="form-group">
                            <label for="addCodigo">codigo:</label>
                            <input type="text" id="addCodigo" placeholder="C√≥digo do log" value="LOG${timestamp}">
                        </div>
                        <div class="form-group">
                            <label for="addApelido">apelido:</label>
                            <input type="text" id="addApelido" placeholder="Apelido" value="Teste">
                        </div>
                        <div class="form-group">
                            <label for="addAcessou">acessou:</label>
                            <input type="text" id="addAcessou" placeholder="O que foi acessado" value="P√°gina de Teste">
                        </div>
                        <div class="form-group">
                            <label for="addLocal">local:</label>
                            <input type="text" id="addLocal" placeholder="Local do acesso" value="Admin">
                        </div>
                        <div class="form-group">
                            <label for="addTipo">tipo:</label>
                            <input type="text" id="addTipo" placeholder="Tipo de a√ß√£o" value="teste">
                        </div>
                    `;
                    break;
            }
            
            container.innerHTML = fieldsHTML;
        }
        
        // Executar teste
        async function executeTest() {
            const action = document.getElementById('testAction').value;
            
            // Construir par√¢metros baseado na a√ß√£o
            let params = { action: action };
            
            switch(action) {
                case 'read':
                    params.sheet = document.getElementById('readSheet').value;
                    const search = document.getElementById('readSearch').value;
                    const page = document.getElementById('readPage').value;
                    const limit = document.getElementById('readLimit').value;
                    
                    if (search) params.search = search;
                    if (page && page !== '1') params.page = page;
                    if (limit && limit !== '20') params.limit = limit;
                    break;
                    
                case 'add':
                    params.sheet = document.getElementById('addSheet').value;
                    
                    // Coletar campos espec√≠ficos para cada aba
                    switch(params.sheet) {
                        case 'Aulas':
                            params.categoria = document.getElementById('addCategoria').value;
                            params.nome = document.getElementById('addNome').value;
                            params.url = document.getElementById('addUrl').value;
                            params.tipo = document.getElementById('addTipo').value;
                            break;
                            
                        case 'Usuarios':
                            params.codigo = document.getElementById('addCodigo').value;
                            params.apelido = document.getElementById('addApelido').value;
                            params['aulas conclu√≠das'] = document.getElementById('addAulasConcluidas').value;
                            params['aulas dispon√≠veis'] = document.getElementById('addAulasDisponiveis').value;
                            params['acesso treinamento'] = document.getElementById('addAcessoTreinamento').value;
                            break;
                            
                        case 'Arquivos':
                            params.id = document.getElementById('addId').value;
                            params.nome = document.getElementById('addNome').value;
                            params.link = document.getElementById('addLink').value;
                            params.tipo = document.getElementById('addTipo').value;
                            break;
                            
                        case 'Logs':
                            params.codigo = document.getElementById('addCodigo').value;
                            params.apelido = document.getElementById('addApelido').value;
                            params.acessou = document.getElementById('addAcessou').value;
                            params.local = document.getElementById('addLocal').value;
                            params.tipo = document.getElementById('addTipo').value;
                            break;
                    }
                    break;
                    
                case 'edit':
                    params.sheet = document.getElementById('editSheet').value;
                    params.idValue = document.getElementById('editId').value;
                    const field = document.getElementById('editField').value;
                    const value = document.getElementById('editValue').value;
                    
                    if (field && value) {
                        params[field] = value;
                    }
                    break;
                    
                case 'delete':
                    params.sheet = document.getElementById('deleteSheet').value;
                    params.idValue = document.getElementById('deleteId').value;
                    break;
                    
                case 'clear':
                    params.sheet = document.getElementById('clearSheet').value;
                    params.startRow = document.getElementById('clearStartRow').value;
                    const endRow = document.getElementById('clearEndRow').value;
                    if (endRow) params.endRow = endRow;
                    break;
            }
            
            addLog(`üß™ Executando teste: ${action}`, 'info');
            addLog(`üì§ Par√¢metros: ${JSON.stringify(params)}`, 'info');
            
            // SEMPRE usar GET (Apps Script funciona melhor assim)
            await callAPI('GET', params);
        }
        
        // Executar comando manual
        async function executeManual() {
            const method = document.getElementById('manualMethod').value;
            const paramsText = document.getElementById('manualParams').value;
            
            try {
                const params = JSON.parse(paramsText);
                addLog(`üîß Executando manual: ${method}`, 'info');
                addLog(`üì§ Par√¢metros: ${JSON.stringify(params)}`, 'info');
                
                // Usar GET mesmo para a√ß√µes POST (Apps Script aceita)
                await callAPI('GET', params);
                
            } catch (error) {
                addLog(`‚ùå Erro ao parsear JSON: ${error.message}`, 'error');
                showResponse({ error: 'JSON inv√°lido', details: error.message }, false);
            }
        }
        
        // Teste r√°pido de adi√ß√£o
        async function testAddArquivo() {
            const params = {
                action: "add",
                sheet: "Arquivos",
                id: "TESTE-" + Date.now(),
                nome: "Arquivo Teste " + new Date().toLocaleTimeString(),
                link: "https://teste-api.com",
                tipo: "teste"
            };
            
            addLog(`‚ûï Teste r√°pido: Adicionar arquivo`, 'info');
            await callAPI('GET', params);
        }
        
        // Executar testes em lote
        async function runBatchTests() {
            const testsText = document.getElementById('batchTests').value;
            
            try {
                const tests = JSON.parse(testsText);
                addLog(`‚ö° Iniciando batch com ${tests.length} testes`, 'info');
                
                for (let i = 0; i < tests.length; i++) {
                    const test = tests[i];
                    addLog(`üìã Teste ${i+1}/${tests.length}: ${test.description || 'Sem descri√ß√£o'}`, 'info');
                    
                    // Usar GET mesmo se o teste especificar POST
                    await callAPI('GET', test.params, true);
                    
                    // Pequena pausa entre testes
                    if (i < tests.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }
                
                addLog(`‚úÖ Batch conclu√≠do com ${tests.length} testes`, 'success');
                
            } catch (error) {
                addLog(`‚ùå Erro no batch: ${error.message}`, 'error');
            }
        }
        
        // FUN√á√ÉO PRINCIPAL CORRIGIDA - APPS SCRIPT USA GET
        async function callAPI(method, params, isBatch = false) {
            const startTime = Date.now();
            document.getElementById('responseTime').textContent = '‚è≥ Processando...';
            
            try {
                // APPS SCRIPT: sempre usar par√¢metros na URL (querystring)
                const queryParams = new URLSearchParams();
                Object.keys(params).forEach(key => {
                    if (params[key] !== undefined && params[key] !== null) {
                        queryParams.append(key, params[key]);
                    }
                });
                
                const url = `${API_URL}?${queryParams.toString()}`;
                addLog(`üîó URL: ${url}`, 'info');
                
                // Fazer requisi√ß√£o GET (Apps Script funciona melhor assim)
                const response = await fetch(url, {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                document.getElementById('responseTime').textContent = `‚è±Ô∏è ${responseTime}ms`;
                
                // Ler resposta
                let responseText;
                try {
                    responseText = await response.text();
                    addLog(`üìÑ Resposta (${responseText.length} chars): ${responseText.substring(0, 200)}${responseText.length > 200 ? '...' : ''}`, 'info');
                } catch (textError) {
                    addLog(`‚ö†Ô∏è N√£o foi poss√≠vel ler resposta`, 'warning');
                    responseText = '';
                }
                
                // Parsear JSON
                let data;
                try {
                    data = JSON.parse(responseText);
                    addLog(`‚úÖ Resposta parseada: ${data.success ? 'Sucesso' : 'Erro'}`, data.success ? 'success' : 'error');
                } catch (parseError) {
                    addLog(`‚ùå Resposta n√£o √© JSON: ${parseError.message}`, 'error');
                    data = { 
                        error: 'Resposta inv√°lida',
                        rawResponse: responseText.substring(0, 500)
                    };
                }
                
                // Mostrar resposta
                if (!isBatch) {
                    showResponse(data, response.ok);
                }
                
                return data;
                
            } catch (error) {
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                document.getElementById('responseTime').textContent = `‚ùå ${responseTime}ms | ${error.message}`;
                
                addLog(`üí• Erro: ${error.message}`, 'error');
                
                if (!isBatch) {
                    showResponse({ 
                        error: 'Falha na comunica√ß√£o',
                        message: error.message
                    }, false);
                }
                
                return { success: false, error: error.message };
            }
        }
        
        // Mostrar resposta formatada
        function showResponse(data, success) {
            const responseOutput = document.getElementById('responseOutput');
            const responseContainer = document.getElementById('responseContainer');
            
            // Formatar JSON com cores
            const formattedJSON = syntaxHighlight(JSON.stringify(data, null, 2));
            
            responseOutput.innerHTML = formattedJSON;
            responseContainer.scrollTop = 0;
            
            // Destacar erros
            if (!success) {
                responseContainer.style.borderColor = '#ff4444';
                responseContainer.style.boxShadow = '0 0 10px rgba(255, 68, 68, 0.3)';
            } else {
                responseContainer.style.borderColor = '#00ff00';
                responseContainer.style.boxShadow = '0 0 10px rgba(0, 255, 0, 0.3)';
            }
        }
        
        // Highlight de sintaxe JSON
        function syntaxHighlight(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, 
            function(match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }
        
        // Carregar pr√©-visualiza√ß√£o de dados
        async function loadDataPreview() {
            const sheet = document.getElementById('dataPreview').value;
            if (!sheet) return;
            
            addLog(`üìä Carregando pr√©-visualiza√ß√£o de: ${sheet}`, 'info');
            
            const params = {
                action: 'read',
                sheet: sheet,
                limit: 10
            };
            
            const data = await callAPI('GET', params, true);
            
            if (data && data.data && data.data.data) {
                const previewContainer = document.getElementById('dataPreviewContainer');
                previewContainer.innerHTML = `
                    <div style="color: #00ff00; margin-bottom: 10px;">
                        üìã ${data.data.data.length} registros encontrados
                    </div>
                    <pre>${syntaxHighlight(JSON.stringify(data.data.data, null, 2))}</pre>
                `;
            }
        }
        
        // Fun√ß√µes de utilidade
        function clearResponse() {
            document.getElementById('responseOutput').textContent = 'Resposta limpa.';
            document.getElementById('responseTime').textContent = 'Aguardando execu√ß√£o...';
            document.getElementById('responseContainer').style.borderColor = '#444';
            document.getElementById('responseContainer').style.boxShadow = 'none';
        }
        
        function clearManual() {
            document.getElementById('manualParams').value = '{\n  "action": "list"\n}';
            document.getElementById('manualMethod').value = 'GET';
        }
        
        function clearBatch() {
            document.getElementById('batchTests').value = '[\n  {\n    "method": "GET",\n    "params": { "action": "list" },\n    "description": "Listar abas"\n  }\n]';
        }
        
        function clearAllLogs() {
            if (confirm('Tem certeza que deseja limpar todos os logs?')) {
                logs = [];
                updateLogDisplay();
                addLog('üßπ Logs limpos manualmente', 'warning');
            }
        }
        
        function copyResponse() {
            const text = document.getElementById('responseOutput').textContent;
            navigator.clipboard.writeText(text).then(() => {
                addLog('üìã Resposta copiada para clipboard', 'success');
            });
        }
        
        function exportLogs() {
            const logText = logs.map(log => 
                `[${log.timestamp}] ${log.type.toUpperCase()}: ${log.message}`
            ).join('\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `api-debug-logs-${new Date().toISOString().slice(0,19)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addLog('üíæ Logs exportados como arquivo TXT', 'success');
        }
    </script>
</body>
</html>
